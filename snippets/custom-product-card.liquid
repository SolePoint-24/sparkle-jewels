{% comment %}
  Accepts:
  - product: {Object} Product Liquid object.
  - section: {Object} Section object for unique IDs.
{% endcomment %}

{%- liquid
  assign product_url = product.url
  assign first_variant = product.first_available_variant | default: product.variants.first
  assign featured_image = first_variant.image | default: product.featured_image
-%}

<div class="card-wrapper wbproduct-container product-card-wrapper">
  <div class="card card--card color-background-1 gradient on_img_on_hover_quicklook badge-top-left">
<div class="card__inner wbimgblock ratio custom-card__image-wrapper">
      <div class="card__media">
        <a href="{{ product_url }}" title="{{ product.title | escape }}" class="media media--hover-effect">
          {%- if featured_image -%}
            <img
              srcset="
                {%- if featured_image.width >= 360 -%}{{ featured_image | image_url: width: 360 }} 360w,{%- endif -%}
                {%- if featured_image.width >= 533 -%}{{ featured_image | image_url: width: 533 }} 533w,{%- endif -%}
                {%- if featured_image.width >= 720 -%}{{ featured_image | image_url: width: 720 }} 720w,{%- endif -%}
                {{ featured_image | image_url }} {{ featured_image.width }}w
              "
              src="{{ featured_image | image_url: width: 533 }}"
              sizes="(min-width: 992px) calc((100vw - 130px) / 4), (min-width: 768px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
              alt="{{ featured_image.alt | escape }}"
              class="motion-reduce main-product-image"
              loading="lazy"
              width="{{ featured_image.width }}"
              height="{{ featured_image.height }}"
            >
          {%- endif -%}
          {%- if product.images[1] -%}
            <img
              srcset="
                {%- if product.images[1].width >= 360 -%}{{ product.images[1] | image_url: width: 360 }} 360w,{%- endif -%}
                {%- if product.images[1].width >= 533 -%}{{ product.images[1] | image_url: width: 533 }} 533w,{%- endif -%}
                {%- if product.images[1].width >= 720 -%}{{ product.images[1] | image_url: width: 720 }} 720w,{%- endif -%}
                {{ product.images[1] | image_url }} {{ product.images[1].width }}w
              "
              src="{{ product.images[1] | image_url: width: 533 }}"
              sizes="(min-width: 992px) calc((100vw - 130px) / 4), (min-width: 768px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
              alt="{{ product.images[1].alt | escape }}"
              class="motion-reduce hover-product-image"
              loading="lazy"
              width="{{ product.images[1].width }}"
              height="{{ product.images[1].height }}"
            >
          {%- endif -%}
        </a>
      </div>

      <div class="top_atc on_img_on_hover">
        <a href="{{ product_url }}" class="add-to-cart__submit button button--primary">
          <span>Choose option</span>
        </a>
      </div>

      <div class="card__badge">
        {%- if product.compare_at_price > product.price and product.available -%}
          <span class="badge percent__badge-sale">
            {{- product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | money_without_currency | times: 100 | remove: '.0' }}% off -}}
          </span>
        {%- endif -%}
      </div>
    </div>

    <div class="wbproductdes card__content">
      <div class="card__information">
        {%- liquid
          assign color_option_index = 0
          assign has_color_option = false
          for option in product.options_with_values
            if option.name == 'Color' or option.name == 'Colour'
              assign has_color_option = true
              assign color_option_index = forloop.index0
              assign color_option_values = option.values
              break
            endif
          endfor
        -%}

        {%- if has_color_option and color_option_values.size > 1 -%}
          <fieldset class="js product-form__input swatchComponent inner-class parent-display">
            <div class="wbswatchclr">
              {%- for value in color_option_values -%}
                {%- for variant in product.variants -%}
                  {%- if variant.options[color_option_index] == value -%}
                    {%- liquid
                      assign variant_image = variant.image | default: product.featured_image
                      assign swatch_file_name = value | handle | append: '.png'
                      assign swatch_image = images[swatch_file_name]
                    -%}
                    <label
                      class="color-swatch"
                      data-image-src="{{ variant_image | image_url: width: 533 }}"
                      style="
                        background-color: {{ value | downcase | replace: ' ', '' }};
                        {% if swatch_image != blank %}background-image: url({{ swatch_image | image_url: width: 50 }});{% endif %}
                      "
                    >
                      <input type="radio" name="color-swatch-{{ section.id }}-{{ product.id }}" value="{{ value | escape }}" {% if forloop.first %}checked{% endif %}>
                      <span class="tooltip">{{ value }}</span>
                    </label>
                    {%- break -%}
                  {%- endif -%}
                {%- endfor -%}
              {%- endfor -%}
            </div>
          </fieldset>
        {%- endif -%}

        <div class="product__vendor top-spacing">{{ product.collections.first.current_type.size }}</div>
        <h3 class="card__heading h5">
          <a href="{{ product_url }}" class="full-unstyled-link">
            {{ product.title }}
          </a>
        </h3>
        <div class="card-information card_price_bottom">
          <div class="price price--on-sale">
            <div class="price__container">
              <span class="price-item price-item--regular">
                {{ product.price_max| money }}
              </span>
              {% if product.compare_at_price > product.price %}
                <s class="price-item price-item--compare">
                  {{ product.compare_at_price | money }}
                </s>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
 document.addEventListener('DOMContentLoaded', function() {
  const cards = document.querySelectorAll('.product-card-wrapper');
  cards.forEach(card => {
    const swatches = card.querySelectorAll('.color-swatch');
    if (swatches.length === 0) return;

    const mainImage = card.querySelector('.main-product-image');
    const hoverImage = card.querySelector('.hover-product-image');
    if (!mainImage || !hoverImage) return;

    // Set first swatch active
    swatches[0].classList.add('active');
    const firstSrc = swatches[0].getAttribute('data-image-src');
    if (firstSrc) {
      hoverImage.src = firstSrc;
      hoverImage.srcset = firstSrc;
    }

    swatches.forEach(swatch => {
      swatch.addEventListener('click', function(e) {
        e.preventDefault();

        // Reset active states
        swatches.forEach(s => s.classList.remove('active'));
        this.classList.add('active');

        // Update hover image to selected variant
        const newImageSrc = this.getAttribute('data-image-src');
        if (newImageSrc) {
          hoverImage.src = newImageSrc;
          hoverImage.srcset = newImageSrc;
        }
      });
    });
  });
});

</script>
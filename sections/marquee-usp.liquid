{%- comment -%}
 SECTION: Marquee USP
{%- endcomment -%}

<div class="marquee-usp-section color-{{ section.settings.color_scheme }}">
 <div class="page-width">
  {%- if section.settings.heading != blank -%}
   <h2 class="marquee-usp__heading">{{ section.settings.heading | escape }}</h2>
  {%- endif -%}
 </div>

 <div class="marquee-usp__wrapper">
  <div class="marquee-usp__scroller" style="animation-duration: {{ section.settings.animation_speed }}s;">
   {%- for i in (1..4) -%}
    {%- for block in section.blocks -%}
     <div
      class="marquee-usp__item"
      {% if forloop.parentloop.first %}
       {{- block.shopify_attributes -}}
      {% endif %}
     >
      <div class="marquee-usp__icon">
       {%- if block.settings.icon != blank -%}
        {%- comment -%} START: FIX - Create variables first to ensure a valid URL {%- endcomment -%}
        {%- liquid
         assign icon_width = block.settings.icon_width | default: 50
         assign icon_height = block.settings.icon_height | default: 50
        -%}
        <img
         src="{{ block.settings.icon | image_url: width: icon_width, height: icon_height, crop: 'center', scale: 2 }}"
         alt="{{ block.settings.icon.alt | default: block.settings.title }}"
         width="{{ icon_width }}"
         height="{{ icon_height }}"
         loading="lazy"
         style="width: {{ icon_width }}px; height: {{ icon_height }}px;"
        >
        {%- comment -%} END: FIX {%- endcomment -%}
       {%- else -%}
        {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
       {%- endif -%}
      </div>
      <div class="marquee-usp__title">
       <p>{{ block.settings.title | escape }}</p>
      </div>
     </div>
    {%- endfor -%}
   {%- endfor -%}
  </div>
 </div>
</div>

{%- style -%}
 .marquee-usp-section {
  padding: 40px 0;
  background-color: var(--color-background);
  color: var(--color-foreground);
 }
 .marquee-usp__heading {
  text-align: center;
  font-size: 2.5rem;
  margin-bottom: 40px !important;
 }
 .marquee-usp__wrapper {
  overflow: hidden;
  display: flex;
  white-space: nowrap;
 }
 .marquee-usp__scroller {
  display: flex;
  flex-shrink: 0;
  animation: scroll-marquee linear infinite;
 }
 .marquee-usp__wrapper:hover .marquee-usp__scroller {
  animation-play-state: paused;
 }
 .marquee-usp__item {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  margin: 0 40px;
  text-align: center;
 }
 .marquee-usp__icon img {
  object-fit: contain; /* Prevents images from being cropped */
  margin-bottom: 15px;
 }
 .marquee-usp__title {
  font-size: 1.2rem;
  font-weight: 600;
 }
 @keyframes scroll-marquee {
  from {
   transform: translateX(0);
  }
  to {
   transform: translateX(-25%);
  }
 }
 @media screen and (max-width: 750px) {
  .marquee-usp__heading {
   font-size: 2rem;
  }
  .marquee-usp__item {
   margin: 0 25px;
  }
 }
{%- endstyle -%}

{% schema %}
{
  "name": "Marquee USP",
  "tag": "section",
  "class": "marquee-usp-section-wrapper",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Why Choose Us"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "background-1"
    },
    {
      "type": "range",
      "id": "animation_speed",
      "min": 10,
      "max": 100,
      "step": 5,
      "unit": "s",
      "label": "Animation speed",
      "info": "Slower speed is a higher number.",
      "default": 30
    }
  ],
  "blocks": [
    {
      "type": "usp_item",
      "name": "USP Item",
      "limit": 10,
      "settings": [
        {
          "type": "image_picker",
          "id": "icon",
          "label": "Icon Image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Feature Title"
        },
        {
          "type": "range",
          "id": "icon_width",
          "min": 20,
          "max": 150,
          "step": 2,
          "unit": "px",
          "label": "Icon width",
          "default": 50
        },
        {
          "type": "range",
          "id": "icon_height",
          "min": 20,
          "max": 150,
          "step": 2,
          "unit": "px",
          "label": "Icon height",
          "default": 50
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Marquee USP",
      "blocks": [
        { "type": "usp_item" },
        { "type": "usp_item" },
        { "type": "usp_item" },
        { "type": "usp_item" },
        { "type": "usp_item" }
      ]
    }
  ]
}
{% endschema %}
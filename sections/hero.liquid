{% comment %}
  This section creates a full-screen hero banner with an interactive collection carousel.
  - Each slide has a background image and a single button.
  - The button is positioned at the bottom-left.
  - Supports different images for desktop, tablet, and mobile.
  - The carousel supports autoplay with play/pause controls.
{% endcomment %}

<div
  id="Hero-{{ section.id }}"
  class="hero-carousel-section color-{{ section.settings.color_scheme }}"
  data-section-id="{{ section.id }}"
  data-autoplay="{{ section.settings.autoplay }}"
  data-autoplay-speed="{{ section.settings.autoplay_speed }}"
>
  <div class="hero-carousel__media-container">
    {%- for block in section.blocks -%}
      {%- if block.type == 'collection_slide' -%}
        {%- assign collection = block.settings.collection -%}

        {%- assign fallback_image = collection.image | default: collection.products.first.featured_image -%}
        {%- assign image_desktop = block.settings.image_desktop | default: fallback_image -%}
        {%- assign image_tablet = block.settings.image_tablet | default: image_desktop -%}
        {%- assign image_mobile = block.settings.image_mobile | default: image_tablet -%}

        <div class="hero-carousel__media-item{% if forloop.first %} is-active{% endif %}" data-collection-handle="{{ collection.handle | default: block.id }}">
          {% if image_desktop != blank %}
            {%- assign loading_attr = 'lazy' -%}
            {%- assign fetch_priority_attr = 'auto' -%}
            {%- if forloop.first -%}
              {%- assign loading_attr = 'eager' -%}
              {%- assign fetch_priority_attr = 'high' -%}
            {%- endif -%}

           <picture>
             <source
               media="(min-width: 1024px)"
               srcset="{{ image_desktop | image_url: width: 3840 }}"
             >
             <source
               media="(min-width: 768px)"
               srcset="{{ image_tablet | image_url: width: 2048 }}"
             >
             <img
               src="{{ image_mobile | image_url: width: 1534 }}"
               alt="{{ image_desktop.alt | default: collection.title | escape }}"
               loading="{{ loading_attr }}"
               fetchpriority="{{ fetch_priority_attr }}"
               width="{{ image_desktop.width }}"
               height="{{ image_desktop.height }}"
               class="full-height-image"
             >
           </picture>
          {% else %}
            <div class="placeholder-wrapper">{{ 'lifestyle-2' | placeholder_svg_tag: 'placeholder-svg' }}</div>
          {% endif %}
        </div>
      {%- endif -%}
    {%- endfor -%}
  </div>

  <div class="hero-carousel__content-container">
    {%- for block in section.blocks -%}
      {%- if block.type == 'collection_slide' -%}
        {%- assign collection = block.settings.collection -%}
        <div
          class="hero-carousel__content-inner{% if forloop.first %} is-active{% endif %}"
          data-collection-handle="{{ collection.handle | default: block.id }}"
          {{ block.shopify_attributes }}
        >
          {% comment %} Heading, subheading, and text have been removed. {% endcomment %}
          {%- if block.settings.button_label != blank -%}
            <a href="{{ block.settings.button_link | default: collection.url }}" class="button hero-carousel__button">
              {{ block.settings.button_label | escape }}
            </a>
          {%- endif -%}
        </div>
      {%- endif -%}
    {%- endfor -%}
  </div>

  {%- assign collection_slides = section.blocks | where: 'type', 'collection_slide' -%}
  {%- if collection_slides.size > 1 -%}
    <div class="hero-carousel__nav-wrapper">
      <div class="hero-carousel__nav">
        <button type="button" class="hero-carousel__arrow hero-carousel__arrow--prev" aria-label="Previous slide">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
        </button>
        <div class="hero-carousel__titles">
          {%- for block in collection_slides -%}
            {%- assign collection = block.settings.collection -%}
            <a
              href="{{ collection.url }}"
              class="hero-carousel__title-link {% if forloop.first %}is-active{% endif %}"
              data-collection-handle="{{ collection.handle | default: block.id }}"
            >
              {{ collection.title | default: 'Slide' }}
            </a>
          {%- endfor -%}
        </div>
        <button type="button" class="hero-carousel__arrow hero-carousel__arrow--next" aria-label="Next slide">
          <svg xmlns="http://www.w.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
        </button>
        <button type="button" class="hero-carousel__play-pause" aria-label="Pause autoplay">
          <svg class="icon-pause" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 4h4v16H6z"/><path d="M14 4h4v16h-4z"/></svg>
          <svg class="icon-play" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="6 3 20 12 6 21 6 3"/></svg>
        </button>
      </div>
    </div>
  {%- endif -%}
</div>

<script>
 // Your JavaScript remains the same, no changes needed there.
 class HeroCarousel {
   // ... all the previous JS code
 }
 document.addEventListener('DOMContentLoaded', () => {
   const heroCarouselSection = document.getElementById('Hero-{{ section.id }}');
   if (heroCarouselSection) {
     new HeroCarousel(heroCarouselSection);
   }
 });
</script>

{% stylesheet %}
 .hero-carousel-section {
  width: 100vw;
  margin-left: calc(50% - 50vw);
  position: relative;
  height: var(--section-height-desktop); /* Set a height based on viewport */
  color: #000;
  overflow: hidden;
}
@media screen and (max-width: 768px) {
  .hero-carousel-section {
    height: var(--section-height-mobile);
  }
}

 .hero-carousel__media-container {
   position: absolute;
   inset: 0;
   z-index: 1;
   background-color: #f0f0f0;
 }
 
 .hero-carousel__media-container::after {
   content: '';
   position: absolute;
   inset: 0;
   background: linear-gradient(to right, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 60%);
   z-index: 2;
 }

 .hero-carousel__media-item {
   width: 100%; height: 100%;
   opacity: 0;
   transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1);
   position: absolute; inset: 0; z-index: 1;
 }
 
 .hero-carousel__media-item.is-active {
   opacity: 1; z-index: 2;
 }
 
 .hero-carousel__media-item picture,
 .hero-carousel__media-item img {
   display: block;
   width: 100%;
   height: 100%;
   object-fit: cover;
   object-position: center;
 }
 
 .hero-carousel__media-item .placeholder-wrapper {
   height: 100%;
   display: flex; align-items: center; justify-content: center;
 }

 .hero-carousel__content-container {
   position: relative; z-index: 3;
   width: 100%; padding: 0 5vw;
   display: flex;
   /* UPDATED: Aligns content to the bottom */
   align-items: flex-end; 
   height: 100%;
 }

 .hero-carousel__content-inner {
   /* UPDATED: Simplified for button-only layout */
   padding-bottom: 3rem; 
   opacity: 0;
   transform: translateY(20px);
   transition: opacity 0.6s ease 0.2s, transform 0.6s ease 0.2s;
   pointer-events: none;
 }
 
 .hero-carousel__content-inner.is-active {
   opacity: 1; transform: translateY(0); pointer-events: auto;
 }
 .hero-carousel__content-inner .button {
   pointer-events: auto;
 }

 .hero-carousel__button {
   background-color: transparent; border: 1px solid #000; color: #000;
   padding: 12px 28px; text-decoration: none;
   transition: background-color 0.3s, color 0.3s;
   /* UPDATED: Margin removed for cleaner alignment */
   font-size: 0.9rem;
 }
 .hero-carousel__button:hover { background-color: #000; color: #fff; }

 .hero-carousel__nav-wrapper {
   position: absolute; bottom: 3rem; left: 0;
   width: 100%; z-index: 4;
   display: flex; justify-content: flex-end;
   padding: 0 5vw; pointer-events: none;
 }

 .hero-carousel__nav {
   display: flex; align-items: center;
   gap: 1rem; pointer-events: auto;
 }

 .hero-carousel__titles { display: flex; gap: 1.5rem; }
 .hero-carousel__title-link {
   color: #000; text-decoration: none; font-size: 1rem; opacity: 0.6;
   position: relative; transition: opacity 0.3s; padding-bottom: 5px;
 }
 .hero-carousel__title-link:hover, .hero-carousel__title-link.is-active { opacity: 1; }
 .hero-carousel__title-link.is-active::after {
   content: ''; position: absolute; bottom: 0; left: 0;
   width: 100%; height: 1px; background-color: #000;
 }

 .hero-carousel__arrow, .hero-carousel__play-pause {
   background: none; border: none; cursor: pointer; padding: 0.5rem;
   color: #000; opacity: 0.7; transition: opacity 0.3s;
   display: flex; align-items: center; justify-content: center;
   flex-shrink: 0;
 }
 .hero-carousel__arrow svg, .hero-carousel__play-pause svg {
   width: 20px; height: 20px;
 }
 .hero-carousel__arrow:hover, .hero-carousel__play-pause:hover { opacity: 1; }
 
 .hero-carousel__play-pause .icon-play { display: none; }
 .hero-carousel__play-pause .icon-pause { display: block; }
 .hero-carousel__play-pause.is-paused .icon-play { display: block; }
 .hero-carousel__play-pause.is-paused .icon-pause { display: none; }
 
 @media screen and (max-width: 768px) {
   .hero-carousel-section { color: #fff; }
   .hero-carousel__media-container::after { background: linear-gradient(to top, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0) 70%); }
   
   .hero-carousel__content-inner {
     /* UPDATED: Mobile positioning for bottom-left */
     position: absolute;
     left: 5vw;
     bottom: 8rem; /* Higher to avoid the nav bar */
     padding: 0;
     transform: translateY(20px);
   }
    .hero-carousel__content-inner.is-active {
     transform: translateY(0);
   }

   .hero-carousel__button, .hero-carousel__button:hover { border-color: #fff; color: #fff; }
   .hero-carousel__button:hover { background-color: #fff; color: #000; }
   
   .hero-carousel__nav-wrapper {
     bottom: 1rem;
     left: 50%; transform: translateX(-50%);
     width: 100%; justify-content: center; padding: 0 1rem;
   }
   .hero-carousel__nav {
     max-width: 400px; justify-content: center;
     background: none; backdrop-filter: none;
     padding: 0; border-radius: 0;
   }
   .hero-carousel__arrow, .hero-carousel__title-link, .hero-carousel__play-pause { color: #fff; }
   .hero-carousel__title-link.is-active::after { background-color: #fff; }
 }
{% endstylesheet %}

{% schema %}
{
  "name": "Hero Carousel",
  "tag": "section",
  "class": "section--full-width",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    },
    {
      "type": "range",
      "id": "section_height_desktop",
      "label": "Desktop Section Height",
      "min": 50,
      "max": 100,
      "step": 5,
      "unit": "vh",
      "default": 80
    },
    {
      "type": "range",
      "id": "section_height_mobile",
      "label": "Mobile Section Height",
      "min": 50,
      "max": 100,
      "step": 5,
      "unit": "vh",
      "default": 70
    },
    {
      "type": "header",
      "content": "Autoplay"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Enable Autoplay",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Slide Duration",
      "min": 3000,
      "max": 9000,
      "step": 500,
      "unit": "ms",
      "default": 5000
    }
  ],
  "blocks": [
    {
      "type": "collection_slide",
      "name": "Collection Slide",
      "limit": 5,
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "image_picker",
          "id": "image_desktop",
          "label": "Desktop Background Image"
        },
        {
          "type": "image_picker",
          "id": "image_tablet",
          "label": "Tablet Background Image"
        },
        {
          "type": "image_picker",
          "id": "image_mobile",
          "label": "Mobile Background Image"
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Button Label"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button Link",
          "info": "Optional. Defaults to the collection URL."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Hero Carousel",
      "blocks": [
        { "type": "collection_slide" },
        { "type": "collection_slide" },
        { "type": "collection_slide" }
      ]
    }
  ]
}
{% endschema %}